import { config } from "./config";
import { getProxyTarget } from "./proxy";
import { assign } from "lodash";
import type { Plugin } from "vite";
import { tailwindPlugin } from "./tailwind";
import { ctxPlugin } from "./ctx";
import { codePlugin } from "./code";

export function cool(options: Config.Options) {
  // 请求地址
  config.reqUrl = getProxyTarget(options.proxy);

  // 编译平台
  config.utsPlatform = process.env.UNI_UTS_PLATFORM ?? "web";

  // 是否为插件
  config.isPlugin = options.isPlugin ?? false;

  // tailwind
  if (options.tailwind) {
    assign(config.tailwind, options.tailwind);
  }

  // 插件
  const plugins: Plugin[] = [...codePlugin(), ctxPlugin()];

  if (config.tailwind.enable) {
    plugins.push(...tailwindPlugin());
  }

  return plugins;
}
